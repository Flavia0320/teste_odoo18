<?xml version="1.0" ?>
<odoo>
    <record id="purchase_order_line_work_job_list" model="ir.ui.view">
        <field name="name">purchase_order_line.inherit.form</field>
        <field name="model">purchase.order.line</field>
        <field name="inherit_id" ref="purchase.purchase_order_line_tree" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_id']" position="after">
            	<field name="project_id" invisible="1"/>
                <field name="task_id" options="{'no_create': True, 'no_open': True}" domain="[('project_id','in',[project_id]),('parent_id','=',False)]" />
            </xpath>
        </field>
    </record>
    <record id="purchase_order_line_work_job_form" model="ir.ui.view">
        <field name="name">purchase_order_line.inherit.form</field>
        <field name="model">purchase.order.line</field>
        <field name="inherit_id" ref="purchase.purchase_order_line_form2" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_id']" position="after">
            	<field name="project_id" invisible="1"/>
                <field name="task_id" options="{'no_create': True, 'no_open': True}" domain="[('project_id','in',[project_id]),('parent_id','=',False)]" />
            </xpath>
        </field>
    </record>
    <record id="purchase_order_form" model="ir.ui.view">
        <field name="name">purchase.order.form</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form" />
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button type="object" name="action_view_projects" class="oe_stat_button" icon="fa-folder-open" invisible="construction_project_count == 0">
                    <field name="construction_project_count" widget="statinfo" string="Projects"/>
                </button>
            </xpath>
<!--            <xpath expr="//field[@name='requisition_id']" position="after">-->
<!--                <field name="project_id"/>-->
<!--            </xpath>-->
<!--            <xpath expr="//field[@name='order_line']" position="attributes">-->
<!--                <attribute name="context">{'default_project_id': project_id}</attribute>-->
<!--            </xpath>-->
            <xpath
                expr="//field[@name='order_line']//field[@name='analytic_distribution']"
                position="after"
            >
                <field
                    name="project_id"
                    optional="hide"
                    options="{'no_create': True, 'no_open': True}"
                    domain="[('is_construction_site','=',True)]"
                />
                <field
                    name="task_id"
                    optional="hide"
                    options="{'no_create': True, 'no_open': True}"
                    domain="[('project_id','in',[project_id]),('parent_id','=',False)]"
                />
                <field
                    name="task_product_ids" invisible="1"
                />
            </xpath>
        </field>
    </record>
    
</odoo>
