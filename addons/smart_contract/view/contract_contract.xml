<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <template id="smart_contract_view_element_template">
            <t t-set="elemente" t-value="elements"/>
            <t t-foreach="elemente" t-as="elem">
                <div style="padding-left:20px;">
                    <t t-if="elem.tip=='capitol'">
                        <div class="title" style="margin-bottom:10px;font-size: 16px;"> <b><span t-esc="elem.numar"/></b> <span t-esc="elem.name"/>
                            <t t-if="elem.cleartext">
                                <span t-att-data-oe-readonly="contract.status not in ['draft','intocmit']" t-field="elem.text"/>
                            </t>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="title" style="margin-bottom:10px;font-size: 16px;"> <b><span t-esc="elem.numar"/></b> <span t-esc="elem.name"/>
                            <span t-att-data-oe-readonly="contract.status not in ['draft','intocmit']" t-field="elem.text"/>
                        </div>
                    </t>
                    <t t-if="elem.child_ids" style="font-size: 16px;">
                        <t t-call="smart_contract.smart_contract_view_element_template">
                            <t t-set="elements" t-value="elem.child_ids"/>
                        </t>
                    </t>
                </div>
            </t>
        </template>

        <template id="smart_contract_view" name="Smart Contract View">
            <t t-set="no_footer">1</t>
            <style>
                .o_header_affix, #oe_snippets, .o_affix_enabled, .o_footer{
                    display:none !important;
                }
                html body.editor_enable.editor_has_snippets{
                    padding-left: 0 !important;
                }
            </style>
            <t t-call="website.layout">
                <t t-set="pageName" t-value="'Contract %s' % contract.name"/>
                <div id="wrap" style="background: url(/web/static/src/img/form_sheetbg.png);">
                    <div class="container">
                        <a  data-oe-readonly="1" role="button" style="margin-top: 20px;" t-attf-href="/web#view_type=form&amp;model=smart.contract&amp;id=#{contract.id}&amp;action=smart_contract.action_contract" class="btn btn-primary"><i class="fa fa-arrow-left"/> Back to Contract Form</a>
                        <div class="oe_structure oe_empty" style="padding: 20px;margin: 20px 0;border: 1px solid #c8c8d3;box-shadow: 0 4px 20px rgb(0 0 0 / 15%);background: #ffff;">
                            <div class="text-center font-weight-bold">
            					<h2>
            						<span data-oe-readonly="1" t-if="contract.document_type=='contract'">
            							Contract
            						</span>
            						<span data-oe-readonly="1" t-if="contract.document_type=='act'">
            							Contract Addendum
            						</span>
            						<t data-oe-readonly="1" t-if="not contract.nr_document">
            							DRAFT "<span t-esc="contract.name"/>" / <span t-field="contract.create_date"/>
            						</t>
            						<t data-oe-readonly="1" t-if="contract.nr_document">
            							<span>Nr. <span t-esc="contract.nr_document"/></span>
            						</t>
            						<span data-oe-readonly="1" t-if="contract.document_type=='act'">
            							to Contract
                                        <t data-oe-readonly="1" t-if="not contract.parent_id.nr_document">
                                            DRAFT "<span t-esc="contract.parent_id.name"/>" / <span t-field="contract.parent_id.create_date"/>
                                        </t>
                                        <t data-oe-readonly="1" t-if="contract.parent_id.nr_document">
                                            <span>Nr. <span t-esc="contract.parent_id.nr_document"/></span>
                                        </t>
            						</span>
            					</h2>
            				</div>
            				<div>
            					<t t-call="smart_contract.smart_contract_view_element_template">
                                    <t t-set="elements" t-value="contract.elemente_ids"/>
                                </t>
            				</div>
            				<div class="w-100" style="padding-left:20px;" data-oe-readonly="1">
            					<p data-oe-readonly="1">Closed today <span data-oe-readonly="1" t-field="contract.signed_date"/> in 2 original copies, signed and stamped by the parties on each page.</p>
            				</div>
            				<div data-oe-readonly="1">
            					<div class="row" data-oe-readonly="1">
            						<div class="col" style="padding-left:20px;" data-oe-readonly="1">
            							<span class="font-weight-bold" data-oe-readonly="1">Provider:</span><br/>
            							<span data-oe-readonly="1" t-esc="res_company.name"/>
            						</div>
            						<div class="col" data-oe-readonly="1"/>
            						<div data-oe-readonly="1" class="col text-center">
            							<span data-oe-readonly="1" class="font-weight-bold">Client:</span><br/>
            							<span data-oe-readonly="1" t-esc="contract.partner_id.name"/>
            						</div>
            					</div>
            				</div>
                        </div>
                    </div>
                </div>
            </t>
        </template>
    </data>

    <record id="contract_form" model="ir.ui.view">
            <field name="name">smart.contract.form</field>
            <field name="model">smart.contract</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button type="object" name="cancel" string="Cancel" invisible="status not in ['semnat','receptionat']"/>
                        <button type="object" name="intocmire" string="Ready" invisible="status != 'draft'"/>
                        <button type="object" class="btn-primary" name="setNumber" string="Set Number" invisible="status in ['draft', 'anulat', 'semnat','receptionat'] or nr_document != False"/>
                        <button type="object" class="btn-primary" name="set_signed" string="Sign" invisible="status in ['draft', 'anulat', 'semnat','receptionat']"/>
                        <button type="object" class="btn-primary" name="action_add_attachment" string="Adauga atasament"/>
                        <button name="toggle_active" string="Restore" type="object" invisible="active == True"/>
                        <button string="Web Edit" type="object" name="web_edit" class="btn btn-primary" invisible="status not in ['draft','intocmit']"/>
                        <field name="status" widget="statusbar"/>
                    </header>
                    <sheet>
                        <field name="active" invisible="1"/>
                        <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active == True"/>

                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Contract Name"/>
                            </h1>
                            <div class="o_row" invisible="nr_document == False">
                                Document No.: <field name="nr_document"/>
                            </div>
                        </div>
                        <group>
                            <group string="Client">
                                <field name="partner_id" required="1" readonly="nr_document != False"/>
                                <field name="legal_partner_id" required="1" context="{'default_parent_id': partner_id, 'default_type': 'contact'}" domain="[('parent_id', '=', partner_id),('is_company','=',False)]"/>
                            </group>
                            <group string="Data">
                                <field name="date_start" readonly="status in ['semnat','anulat']"/>
                                <field name="date_end" readonly="status in ['semnat','anulat']"/>
<!--                                <field name="create_date" attrs="{'readonly':[('nr_document','!=', False)]}"/>-->
                                <field name="signed_date" readonly="status in ['anulat', 'semnat']" required="status not in ['draft']"/>
                                <field name="recive_date" invisible="status in ['anulat','draft']"/>
                                <button type="object" name="set_recive" string="Received" invisible="recive_date == False or status in ['anulat','draft','receptionat']"/>
                            </group>
                        </group>
                        <group>
                            <group string="Template">
                                <field name="id" invisible="1"/>
                                <field name="show_regulation" invisible="1"/>
                                <field name="required_regulation" invisible="1"/>
                                <field name="document_type" readonly="nr_document != False"/>
                                <field name="is_child" invisible="1"/>
                                <field name="parent_id" invisible="document_type == 'contract' or is_child == True" readonly="nr_document != False" domain="[('partner_id','=',partner_id),('parent_id','=',False)]"/>
                                <field name="template_contract_id" readonly="status in ['semnat','anulat']"/>
                                <span class="o_form_label o_td_label" invisible="status in ['semnat','anulat'] or template_contract_id == False">
                                    <b/>
                                </span>
                                <div invisible="status in ['semnat','anulat'] or template_contract_id == False">
                                    <button string="Populate" type="object" invisible="status in ['semnat','anulat'] or template_contract_id == False" name="populate_with_data" class="btn btn-primary"/>
                                </div>
                            </group>
                            <group/>
                        </group>
                        <notebook>
                            <page name="contract_details" string="Contract Details">
                              <group>
                                <group name="contract_serials" string="Serials">
                                    <field name="company_id" readonly="nr_document != False"/>
                                    <field name="regulation_id" domain="[('document_type','in',[document_type, False])]" invisible="document_type == 'act'" readonly="show_regulation == False" required="required_regulation == True"/>
                                    <field name="can_change_regulation_adition_id" invisible="1"/>
                                    <field name="regulation_adition_id" invisible="document_type =='act' or can_change_regulation_adition_id == False" domain="[('document_type','=','act')]"/>
                                </group>
                                <group name="contract_values" string="Values">
                                  <field name="currency_id" readonly="nr_document != False"/>
                                  <field name="valoare_fixa" readonly="nr_document != False"/>
                                  <field name="valoare_fara_tva" readonly="nr_document != False"/>
                                  <field name="valoare" readonly="nr_document != False"/>
	                              </group>
	                             </group>
                            </page>
                            <page name="elements_page" string="Articles">
                            	<group>
                            		<group>
                                  <span class="o_form_label o_td_label">
                                      <b>Variable Count:</b>
                                  </span>
                                  <div>
                                      <field name="variable_count" style="width:10%;vertical-align: super;"/>
                                      <button style="width:90%;" string="Parse Variables" type="object" name="ParseVariable" class="btn btn-primary" invisible="variable_count == 0"/>
                                  </div>
                            		</group>
                            		<group>
                                  <span class="o_form_label o_td_label">
                                      <b/>
                                  </span>
                                  <div>
                                      <button string="Re-Order" type="object" name="reNumber" class="btn btn-primary float-end"/>
                                  </div>

                            		</group>
                            	</group>
                                <field name="elemente_ids" context="{'contract_id':id, 'type':'contract', 'element':None}" readonly="nr_document != False"/>
                                <p class="oe_grey oe_edit_only">
                                    - $\{contract.field\} or $\{contract.object\}.method() global, contract fields method<br/>
                                    - $\{attrelation.key\}.[field_name] global from contract.relations<br/>
                                    - $\{localrelation\}.key local(this element)
                                </p>
                            </page>
                            <page name="order_page" string="Sale Orders" invisible="not sale_ids">
                                <field name="sale_ids" readonly="1"/>
                            </page>
                            <page name="purchase_order_page" string="Purchase Orders" invisible="not purchase_ids">
                                <field name="purchase_ids" readonly="1"/>
                            </page>

                            <page name="aditional_page" string="Contract Addendums" invisible="document_type == 'act' and child_ids == False or nr_document != False">
                                <field name="child_ids" readonly="1"/>
                            </page>
                            <page name="execution_page" string="Execution Destination">
                                <field name="execution_ids" readonly="nr_document != False"/>
                            </page>
                            <page name="relation_page" string="Contract Actions (In relationship with other objects)">
                            	<field name="id" invisible="1"/>
                                <field name="related_object_ids" readonly="nr_document != False">
                                	<list>
                                		<field name="object_id"/>
                                		<field name="autoexec"/>
                                		<field name="exec_date"/>
                                	</list>
                                	<form string="Related Object">
                                		<sheet>
                                			<group>
                                				<field name="name" domain="[('id','in',[parent.id])]"/>
                                				<field name="object_id"/>
                                				<field name="server_action"/>
                                				<field name="autoexec"/>
                                				<field name="racursiv"/>
                                				<field name="exec_date"/>
                                			</group>
                                		</sheet>
                                		<notebook>
                                			<page string="Keys">
                                				<field name="aditional_data_ids"/>
                                			</page>
                                		</notebook>
                                	</form>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <!-- <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div> -->
                </form>
            </field>
    </record>

    <record id="contract_tree" model="ir.ui.view">
        <field name="name">smart.contract Tree</field>
        <field name="model">smart.contract</field>
        <field name="type">list</field>
        <field name="arch" type="xml">
            <list>
                <field name="name" />
                <field name="partner_id" />
                <field name="document_type" />
                <field name="create_date" />
                <field name="nr_document" />
                <field name="signed_date" />
            </list>
        </field>
    </record>

    <record id="contract_search" model="ir.ui.view">
        <field name="name">smart.contract.view.search</field>
        <field name="model">smart.contract</field>
        <field name="arch" type="xml">
            <search string="Contract">
                <group expand="0" string="Group By">
                    <filter name="search_default_document_type" string="Document type" context="{'group_by': 'document_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <odoo>
    <record id="action_smart_contract" model="ir.actions.act_window">
        <field name="name">Contracte</field>
        <field name="res_model">smart.contract</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'group_by': ['document_type']}</field>
    </record>
</odoo>



    <record id="action_contract" model="ir.actions.act_window">
        <field name="name">Contracts</field>
        <field name="res_model">smart.contract</field>
        <field name="view_mode">list,form</field>
    </record>

    <menuitem id="root_menu_contracts"
        name="Contracts"
        sequence="35"
        web_icon="smart_contract,static/description/icon.png"
    />

    <menuitem id="menu_contracts"
        name="Contracts"
        parent="root_menu_contracts"
        sequence="0"
        action="action_contract" />

    <record id="contract_element_form" model="ir.ui.view">
            <field name="name">smart.contract.element.form</field>
            <field name="model">smart.contract.element</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                	<sheet>
                		<group>
                			<group>
                				<field name="name"/>
                				<field name="tip"/>
                				<field name="id" invisible="1"/>
                			</group>
                			<group>
                				<field name="numar"/>
                				<field name="parent_id" invisible="1"/>
                			</group>
                		</group>
                		<notebook>
                			<page string="Content">
                				<field name="text"/>
                			</page>
                			<page string="Attributes">
                				<field name="attribute_ids"/>
                			</page>
                			<page string="Sub Units" invisible="tip == 'alineat'">
                				<field name="child_ids" context="{'contract_id':None, 'type':tip, 'element':id}"/>
                			</page>
                		</notebook>
                	</sheet>
                </form>
            </field>
	</record>

    <record id="contract_element_tree" model="ir.ui.view">
           <field name="name">smart.contract.element.tree</field>
           <field name="model">smart.contract.element</field>
           <field name="type">list</field>
           <field name="arch" type="xml">
               <list>
               		<field name='order' widget='handle'/>
               		<field name="name"/>
               		<field name="tip"/>
               		<field name="numar"/>
               		<field name="parent_id" invisible="1"/>
               </list>
           </field>
    </record>
</odoo>