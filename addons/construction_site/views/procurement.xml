<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
        <record id="project_site_procurement_form" model="ir.ui.view"> 
                <field name="name">project.site.procurement Form</field>
                <field name="model">project.site.procurement</field>
                <field name="type">form</field> 
                <field name="arch" type="xml">
                    <form string="Procurement Wizard">
                        <header>
                            <button name="executeProcurement" string="Execute" class="oe_highlight"
                                    type="object" invisible="state =='done'" />
                            <button name="load_materials_planned" string="Load Planned Materials" type="object" class="oe_highlight" confirm="Action will replace materials list. Proceed?"/>
                            <button name="cancelProcurement" string="Cancel" type="object" class="oe_highlight" confirm="Action will cancel procurement. Proceed?" invisible="state == 'done'"/>
                            <field name="state" widget="statusbar"/>
                        </header>
                        <sheet>
                        	<div class="oe_button_box" name="button_box">
			                    <button type="object" name="action_view_purchases" class="oe_stat_button" icon="fa-credit-card" invisible="purchase_count == 0">
			                        <field name="purchase_count" widget="statinfo" string="Purchase"/>
			                    </button>
			                    <button type="object" name="action_view_transfer" class="oe_stat_button" icon="fa-truck" invisible="picking_count == 0">
			                        <field name="picking_count" widget="statinfo" string="Transfer"/>
			                    </button>
		                    </div>
							<div class="oe_title">
		                        <h1 class="d-flex">
		                            <field name="name" readonly="1" required="1"/>
		                        </h1>
		                    </div>
                            <group>
                                <group>
                                    <field name="project_id" invisible="1"/>
                                    <field name="posible_wh_ids" invisible="1"/>
                                    <field name="procurement_type" readonly="state == 'done'"/>
                                    <field name="warehouse_id" required="1" readonly="state == 'done'" domain="[('id','in',posible_wh_ids)]"/>
                                    <field name="location_id" invisible="1"/>
                                </group>
                                <group>
                                    <field name="route_type" invisible="1"/>
                                    <field name="route_id"
                                           domain="[('rule_ids.location_dest_id','in',[location_id])]"
                                           invisible="procurement_type != 'in_site'"
                                           required="procurement_type == 'in_site'" readonly="state == 'done'"
                                    />
                                    <field name="task_id" invisible="1"/>
                                    <field name="executed_date" readonly="state == 'done'"
                                    		invisible="state != 'done'"/>
                                     <field name="permit_purchase_inform_user_ids" invisible="1"/>
                                     <field name="purchase_inform_user_ids" 
                                            invisible="route_type == 'buy'"
                                            readonly="state !='draft'"
                                            required="state == 'draft' and route_type == 'buy'"
                                     		widget="many2many_tags"
                                     		domain="[('id','in',permit_purchase_inform_user_ids)]"
                                     		options="{'no_quick_create': True, 'no_create_edit' : True}"
                                     		/>
                                     <field name="permit_stock_inform_user_ids" invisible="1"/>
                                     <field name="stock_inform_user_ids"
                                            invisible="route_type == 'transfer'"
                                            readonly="state != 'draft'"
                                            required="state == 'draft' and route_type == 'transfer'"
                                     		widget="many2many_tags"
                                     		domain="[('id','in',permit_stock_inform_user_ids)]"
                                     		options="{'no_quick_create': True, 'no_create_edit' : True}"
                                     		/>
                                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                </group>
                            </group>
                            <notebook>
                                <page string="Products">
                                    <field 
                                    	name="task_product_ids" 
                                    	context="{'default_project_id': project_id, 'default_task_id': task_id}"
                                    	readonly="state == 'done'"
                                    >
                                        <form>
                                            <group>
                                                <field name="project_id" invisible="1"/>
                                                <field name="restrict_product" widget="boolean_toggle"/>
                                                <field name="task_id" invisible="1"/>
                                                <field name="product_id"/>
                                                <field name="supplier_id"/>
                                                <field name="to_procure_qty"/>
                                                <field name="planned_date"/>
                                            </group>
                                        </form>
                                        <list editable="bottom">
                                            <field name="project_id" invisible="1"/>
                                            <field name="restrict_product" invisible="1" widget="boolean_toggle" style="width:70px"/>
                                            <field name="task_id" invisible="1"/>
                                            <field name="product_id"/>
                                            <field name="product_uom_id"/>
                                            <field name="supplier_id"/>
                                            <field name="to_procure_qty"/>
                                            <field name="planned_date"/>
                                        </list>
                                        <kanban class="o_kanban_mobile">
                                            <field name="restrict_product"/>
                                            <field name="product_id"/>
                                            <field name="supplier_id"/>
                                            <field name="to_procure_qty"/>
                                            <field name="planned_date"/>
                                            <templates>
                                                <t t-name="kanban-box">
                                                    <div class="oe_kanban_card oe_kanban_global_click ps-0 pe-0">
                                                        <div class="row g-0">
                                                            <div class="col-2 pe-3">
                                                                <img t-att-src="kanban_image('product.product', 'image_128', record.product_id.raw_value)" t-att-title="record.product_id.value" t-att-alt="record.product_id.value" style="max-width: 100%;"/>
                                                            </div>
                                                            <div class="col-10">
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <strong t-out="record.product_id.value"/>
                                                                    </div>
                                                                    <div class="col-auto">
                                                                        <strong class="float-end text-end" t-out="record.planned_date.value"/>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 text-muted">
                                                                        Quantity:
                                                                        <t t-out="record.to_procure_qty.value"/>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12 text-muted">
                                                                        Supplier:
                                                                        <t t-out="record.supplier_id.value"/>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </templates>
                                        </kanban>
                                    </field>
                                </page>
                            </notebook>
                        </sheet>
                    </form>
                </field>
        </record>
        
    
        <record id="project_site_procurement_list" model="ir.ui.view">
            <field name="name">project.site.procurement list</field>
            <field name="model">project.site.procurement</field>
            <field name="arch" type="xml">
            	<list>
            		<field name="create_uid" readonly="1"/>
            		<field name="name" readonly="1"/>
            		<field name="procurement_type" readonly="1"/>
            		<field name="warehouse_id" readonly="1"/>
            		<field name="project_id" readonly="1"/>
            		<field name="task_id" readonly="1"/>
            		<field name="route_id" readonly="1"/>
            		<field name="executed_date" readonly="1"/>
            		<field name="state" readonly="1"/>
            	</list>
            </field>
        </record>
    
        <record id="project_site_procurement_action" model="ir.actions.act_window"> 
            <field name="name">project.site.procurement Action</field>
            <field name="res_model">project.site.procurement</field>
            <field name="view_mode">list,form</field>
            <field name="target">current</field>
        </record>
    
</odoo>
        
